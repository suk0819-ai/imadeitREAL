<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-adsense-account" content="ca-pub-3208063362565277">
    <title>AI íŒ¨ì…˜ ì»¬ëŸ¬ ë¶„ì„ - ImadeIt</title>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3208063362565277" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
    <style>
        :root { --bg: #f8f9fa; --card: white; --text: #212529; --accent: #6c5ce7; --shadow: rgba(0,0,0,0.1); }
        [data-theme="dark"] { --bg: #1a1a1b; --card: #2d2d2e; --text: #e9ecef; --shadow: rgba(0,0,0,0.4); }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); color: var(--text); margin: 0; transition: all 0.3s; }
        header { background: var(--card); padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px var(--shadow); }
        .logo { font-size: 1.5rem; font-weight: 800; color: var(--accent); text-decoration: none; }
        .container { max-width: 800px; margin: 2rem auto; padding: 0 1rem; }
        .tool-card { background: var(--card); padding: 2rem; border-radius: 1.5rem; box-shadow: 0 10px 30px var(--shadow); text-align: center; }
        .mode-toggle { display: flex; justify-content: center; gap: 1rem; margin-bottom: 2rem; }
        .mode-btn { padding: 0.6rem 1.5rem; border-radius: 2rem; border: 1px solid var(--accent); background: none; color: var(--accent); cursor: pointer; font-weight: bold; }
        .mode-btn.active { background: var(--accent); color: white; }
        #webcam-container canvas { border-radius: 1rem; width: 100% !important; max-width: 400px; height: auto !important; }
        .upload-zone { border: 2px dashed #ccc; padding: 2rem; border-radius: 1rem; cursor: pointer; }
        #preview-img { max-width: 100%; border-radius: 1rem; display: none; margin-top: 1rem; }
        .result-box { margin-top: 2rem; padding: 1.5rem; background: rgba(108, 92, 231, 0.1); border-radius: 1rem; display: none; }
        #harmony-judgment { font-size: 1.8rem; font-weight: bold; color: var(--accent); margin-bottom: 0.5rem; }
        footer { text-align: center; padding: 3rem; opacity: 0.7; font-size: 0.9rem; }
        #label-container div { margin: 0.3rem 0; font-size: 0.9rem; }
    </style>
</head>
<body data-theme="light">
    <header>
        <a href="index.html" class="logo">ImadeIt</a>
        <button id="theme-toggle" style="background:none; border:1px solid #ccc; padding:0.5rem 1rem; border-radius:2rem; cursor:pointer;">ğŸŒ™ ë‹¤í¬ ëª¨ë“œ</button>
    </header>

    <main class="container">
        <div class="tool-card">
            <h1>ğŸ‘— íŒ¨ì…˜ ì»¬ëŸ¬ ì¡°í™” ë¶„ì„ (AI)</h1>
            <p>AIê°€ ë‹¹ì‹ ì˜ ì˜· ìƒ‰ê¹” ì¡°í™”ë¥¼ íŒë‹¨í•´ë“œë¦½ë‹ˆë‹¤.</p>

            <div class="mode-toggle">
                <button class="mode-btn active" onclick="switchMode('upload')">ì‚¬ì§„ ì—…ë¡œë“œ</button>
                <button class="mode-btn" onclick="switchMode('webcam')">ì‹¤ì‹œê°„ ì›¹ìº </button>
            </div>

            <!-- Upload Mode -->
            <div id="upload-mode">
                <div class="upload-zone" onclick="document.getElementById('file-input').click()">
                    ğŸ“¸ í´ë¦­í•˜ì—¬ ì½”ë”” ì‚¬ì§„ ì„ íƒ
                    <img id="preview-img" src="">
                </div>
                <input type="file" id="file-input" accept="image/*" style="display:none;" onchange="handleUpload(this)">
                <button id="analyze-btn" onclick="predictImage()" style="margin-top:1.5rem; padding:1rem 2rem; background:var(--accent); color:white; border:none; border-radius:2rem; cursor:pointer; font-weight:bold; width:100%;">ë¶„ì„ ì‹œì‘í•˜ê¸°</button>
            </div>

            <!-- Webcam Mode -->
            <div id="webcam-mode" style="display:none;">
                <button type="button" onclick="initWebcam()" style="padding:1rem 2rem; background:var(--accent); color:white; border:none; border-radius:2rem; cursor:pointer; font-weight:bold; margin-bottom:1rem;">ì›¹ìº  ì‹œì‘í•˜ê¸°</button>
                <div id="webcam-container"></div>
            </div>

            <div id="result-box" class="result-box">
                <div id="harmony-judgment">ë¶„ì„ ì¤‘...</div>
                <div id="label-container"></div>
                <p id="advice-text" style="margin-top:1rem;"></p>
            </div>
        </div>
    </main>

    <footer>
        <a href="privacy.html">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a> | <a href="terms.html">ì´ìš©ì•½ê´€</a><br>
        &copy; 2026 ImadeIt. All rights reserved.
    </footer>

    <script>
        const URL = "./my_model/";
        let model, webcam, labelContainer, maxPredictions;
        let currentMode = 'upload';

        async function switchMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('upload-mode').style.display = mode === 'upload' ? 'block' : 'none';
            document.getElementById('webcam-mode').style.display = mode === 'webcam' ? 'block' : 'none';
            if (webcam) { webcam.stop(); document.getElementById('webcam-container').innerHTML = ''; }
            document.getElementById('result-box').style.display = 'none';
        }

        async function loadModel() {
            try {
                model = await tmImage.load(URL + "model.json", URL + "metadata.json");
                maxPredictions = model.getTotalClasses();
            } catch(e) { console.warn("AI ëª¨ë¸ ë¡œë“œ ì‹¤íŒ¨: Fallback ëª¨ë“œ ì‘ë™"); }
        }
        loadModel();

        function handleUpload(input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = document.getElementById('preview-img');
                    img.src = e.target.result;
                    img.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }

        async function initWebcam() {
            if(!model) await loadModel();
            const flip = true;
            webcam = new tmImage.Webcam(400, 400, flip);
            await webcam.setup();
            await webcam.play();
            window.requestAnimationFrame(loop);
            document.getElementById("webcam-container").appendChild(webcam.canvas);
            labelContainer = document.getElementById("label-container");
            document.getElementById('result-box').style.display = 'block';
        }

        async function loop() {
            webcam.update();
            await predict();
            window.requestAnimationFrame(loop);
        }

        async function predict() {
            const prediction = await model.predict(webcam.canvas);
            updateResultUI(prediction);
        }

        async function predictImage() {
            const img = document.getElementById('preview-img');
            if(!img.src) return alert("ì‚¬ì§„ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.");
            if(!model) {
                // Fallback simulation if model not found
                updateResultUI([{className:'ì¡°í™”ë¡œì›€', probability:0.85}, {className:'ë¶€ì¡°í™”', probability:0.15}]);
                document.getElementById('result-box').style.display = 'block';
                return;
            }
            const prediction = await model.predict(img);
            updateResultUI(prediction);
            document.getElementById('result-box').style.display = 'block';
        }

        function updateResultUI(prediction) {
            const lc = document.getElementById('label-container');
            lc.innerHTML = '';
            let best = { className: '', prob: 0 };

            prediction.forEach(p => {
                if (p.probability > best.prob) best = { className: p.className, prob: p.probability };
                const div = document.createElement('div');
                div.innerHTML = `${p.className}: ${(p.probability * 100).toFixed(0)}%`;
                lc.appendChild(div);
            });

            const judgment = document.getElementById('harmony-judgment');
            // 'íŒë‹¨'ì„ ê°•ì¡°í•˜ëŠ” UI
            if (best.className.includes('ì¡°í™”') || best.prob > 0.6) {
                judgment.innerText = "íŒë‹¨: ìƒ‰ìƒ ì¡°í™”ê°€ í›Œë¥­í•©ë‹ˆë‹¤! âœ¨";
                document.getElementById('advice-text').innerText = "ì„ íƒí•˜ì‹  ìƒ‰ìƒ ì¡°í•©ì€ ì‹œê°ì ìœ¼ë¡œ ë§¤ìš° ì•ˆì •ì ì´ê³  ì„¸ë ¨ë˜ì—ˆìŠµë‹ˆë‹¤.";
            } else {
                judgment.innerText = "íŒë‹¨: ë³´ì™„ì´ í•„ìš”í•´ ë³´ì…ë‹ˆë‹¤. ğŸ§";
                document.getElementById('advice-text').innerText = "ë¹„ìŠ·í•œ ëª…ë„ì˜ ë‹¤ë¥¸ ìƒ‰ìƒì„ ì„ì–´ë³´ê±°ë‚˜, í¬ì¸íŠ¸ ì»¬ëŸ¬ë¥¼ í•˜ë‚˜ ì¶”ê°€í•´ë³´ì„¸ìš”.";
            }
        }

        document.getElementById('theme-toggle').addEventListener('click', () => {
            const next = document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            document.body.setAttribute('data-theme', next);
        });
    </script>
</body>
</html>
